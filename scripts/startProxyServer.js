import{createRequire as e}from"module";import*as t from"@capacitor/core";import*as o from"colors";var r={n:e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},d:(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const n=e(import.meta.url)("http");var s=r.n(n);const a=(v={Capacitor:()=>t.Capacitor},f={},r.d(f,v),f),l="undefined"!=typeof process?null===process||void 0===process?void 0:process.env:void 0,i=(!a.Capacitor.isNativePlatform()&&(void 0===l.MODE||l.MODE),"undefined"!=typeof process&&process.argv.includes("--webpack-watch")),d="localhost",c=`http://${d}:8910`,p=[c],u=e=>{switch(e){case 200:return"OK";case 400:return"Bad Request";case 401:return"Unauthorized";case 403:return"Forbidden";case 404:return"Not Found";case 413:return"Content Too Large";case 500:return"Internal Server Error";default:return"Unknown Error"}},g=(e,t=null)=>{e.setHeader("Access-Control-Allow-Origin",t||"*"),e.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization")};var v,f;const m=(e=>{var t={};return r.d(t,e),t})({default:()=>o.default}),y=e=>{var t;let o;o="EADDRINUSE"===e.code?`Error: listen EADDRINUSE: ${c} is already in use.`:(null===(t=e.stack)||void 0===t?void 0:t.split("\n")[0])||`Error: ${e.code}: ${e.message}`,console.log(m.default.red(`  ➜ ${o}`))},w=m.default.grey((new Date).toLocaleTimeString(Intl.DateTimeFormat().resolvedOptions().locale))+m.default.cyan.bold(" [webAppDevProxy] "),h=(e,t,o)=>{console.log(w+(o?m.default.yellow("resolving preflight request ➜ "):m.default.green("resolving request ➜ "))+m.default.gray("Status: ")+(e>=200&&e<=299?m.default.green(`${e} - ${u(e)}`):m.default.red(`${e} - ${u(e)}`+(t?`: ${t}`:""))))},$=(e,t,o)=>{const r=(null==o?void 0:o.contentType)||"application/json";h(t),o&&e.setHeader("Content-Type",r),e.writeHead(t),e.end(o?((e,t)=>"application/json"===t?JSON.stringify(e):e.toString())(o.data,r):null)},O=(e,t,o,r,n=null)=>{h(o,r),t.setHeader("Content-Type","application/json"),t.writeHead(o),t.end(JSON.stringify({error:{code:o,http_status:o,message:`${o}: ${u(o)}`,data:n?{debug:n}:{}}})),e.destroy()},N=(e,t)=>{e&&(y(e),process.exit(t||1)),process.exit(t||0)};let T;(()=>{if("undefined"==typeof process)throw new Error("Error: Incompatible environment: This script is supposed to run in a nodeJS environment")})(),console.log((i?"\n":"")+"Starting proxy server for web app development ...\n");try{s().createServer(((e,t)=>{var o;const r=(null===(o=e.url)||void 0===o?void 0:o.replace(/^\//,""))||"/";((e,t)=>{const o="OPTIONS"===t;console.log(w+(o?m.default.yellow("incoming preflight request ➜ "):m.default.green("incoming request ➜ "))+m.default.grey(`URL: ${(o?m.default.yellow:m.default.green)(e)}`+(o?"":` Method: ${m.default.green(t||"UNKNOWN")}`)))})(r,e.method),"OPTIONS"!==e.method?(g(t,e.headers.origin),((e,t,o)=>!!/^https?:\/\/(www\.)?([\w0-9-]+\.)+[a-z]{2,63}(\/[\w0-9-]+)*(\.[\w0-9]+)*([?&][\w0-9-_]+=[\w0-9-_%]*)*$/.test(o)||(O(e,t,400,"Target URL is invalid"),!1))(e,t,r)&&((e,t,o)=>{const r=e.headers["content-type"]||"application/json";let n="",s=0;e.on("data",(o=>{if(s+=o.length,s>2097152){const o="Request body size exceeds proxy server maximum limit (2MB)";O(e,t,413,o,`HTTP Error: 413: ${o}`)}else n+=o})),e.on("end",(async()=>{try{const s=await fetch(o,{method:e.method,headers:{"Content-Type":r},body:n}),a=s.headers.get("content-type")||"application/json",l="application/json"===r?await s.json():s.text();$(t,s.status,{contentType:a,data:l})}catch(o){const{stack:r,code:n,message:s}=o,a=(null==r?void 0:r.split("\n")[0])||`Error: ${n}: ${s}`;O(e,t,500,a,r)}}))})(e,t,r)):((e,t,o)=>{const{origin:r}=e.headers;g(t);let n=null;r?[...p,o].includes(r)||(n={code:403,message:`Origin [${r}] is not allowed to access proxy server`}):n={code:400,message:"Proxy server is unable to determine request origin"},n?O(e,t,n.code,n.message):$(t,200)})(e,t,T)})).listen(8910,d,(()=>{T=(()=>{const{argv:e}=process;if(e.length<=2)return y({code:"NOIONADDRARG",message:"Missing Argument: No Ionic serve address provided"}),null;const t=e[2];return/^(https?:\/\/(www\.)?([\w0-9-]+\.?)+([a-z]{2,63})?|([0-9]{1,3}\.){3}[0-9]{1,3}):[0-9]{1,5}$/.test(t)?t:(y({code:"INVIONADDRARG",message:`Invalid Argument: [${t}] is not a valid Ionic app development server address`}),null)})(),T||N(void 0,1),console.log(`${m.default.green(`  ➜ ${c}`)}\n`)})).on("error",(e=>{N(e)}))}catch(e){N(e)}process.on("SIGTERM",(()=>{process.exit(0)})),process.on("SIGINT",(()=>{process.exit(0)})),process.on("exit",(()=>{console.log("\nShutting down proxy server for web app development ...\n")}));